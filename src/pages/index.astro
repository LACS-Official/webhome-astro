---
// 启用 SSR - 每次请求时动态渲染此页面
export const prerender = false;

import Layout from '~/layouts/PageLayout.astro';

import Content from '~/components/widgets/Content.astro';
import Projects from '~/components/widgets/Projects.astro';
import Sites from '~/components/widgets/Sites.astro';
import Modal from '~/components/Modal.astro';
import type { Project, Site, ApiSiteResponse } from '~/types';

// 导入图片

// API 配置
const API_BASE_URL = 'https://api-g.lacs.cc/api';

// 获取项目数据
let projectsData: Project[] = [];
try {
  const projectsResponse = await fetch(`${API_BASE_URL}/info-management/projects`);
  if (projectsResponse.ok) {
    const projectsResult = await projectsResponse.json();
    if (projectsResult.success && projectsResult.data) {
      projectsData = projectsResult.data;
      console.log('成功获取项目数据，共', projectsData.length, '条记录');
    } else {
      console.warn('项目 API 返回数据格式异常:', projectsResult);
    }
  } else {
    console.error('项目 API 响应错误:', projectsResponse.status, projectsResponse.statusText);
  }
} catch (error) {
  console.error('获取项目数据失败:', error);
}

// 获取站点数据
let sitesData: Site[] = [];
try {
  const sitesResponse = await fetch(`${API_BASE_URL}/websites`);
  if (sitesResponse.ok) {
    const sitesResult = await sitesResponse.json();
    if (sitesResult.success && sitesResult.data && sitesResult.data.websites) {
      // 新的 API 结构：data.websites 包含站点数组
      sitesData = sitesResult.data.websites.map((site: ApiSiteResponse) => ({
        id: site.id,
        name: site.name,
        description: site.description || `访问 ${site.name}`,
        link: site.domain,
        logo: site.logo || '',
        iconContent: site.logo ? '' : site.name.charAt(0), // 如果没有 logo，使用首字母
        bgColor: site.category || '#3B82F6', // 默认蓝色
        analyticsEvent: `visit_${site.name.toLowerCase().replace(/\s+/g, '_')}`,
        category: site.category || '网站',
      }));
      console.log('成功获取站点数据，共', sitesData.length, '条记录');
      console.log('分页信息:', sitesResult.data.pagination);
    } else {
      console.warn('站点 API 返回数据格式异常:', sitesResult);
    }
  } else {
    console.error('站点 API 响应错误:', sitesResponse.status, sitesResponse.statusText);
  }
} catch (error) {
  console.error('获取站点数据失败:', error);
}

const metadata = {
  title: '领创工作室 - 数码科技与创意内容平台',
  ignoreTitleTemplate: true,
};
---

<Layout metadata={metadata}>
  <!-- Hero Widget ******************* -->

  <section class="hero-section relative h-screen w-full not-prose overflow-hidden">
    <!-- 纯色背景 -->
    <div class="absolute inset-0 bg-indigo-600">
      <div class="absolute inset-0 bg-black opacity-40"></div>
    </div>

    <!-- 动态粒子背景 -->
    <div class="absolute inset-0">
      <div class="particles-container"></div>
    </div>

    <!-- 主要内容 -->
    <div class="relative h-full flex items-center justify-center px-4 sm:px-6 lg:px-8 z-10">
      <div class="text-center max-w-5xl mx-auto">
        <!-- 标语 -->
        <p class="text-white text-lg md:text-xl font-bold tracking-widest uppercase mb-6 animate-pulse">领创工作室</p>

        <!-- 主标题 -->
        <h1 class="text-4xl md:text-6xl lg:text-7xl font-bold leading-tighter tracking-tighter mb-6 text-white">
          数码科技与
          <span class="text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 to-pink-300"> 创意内容 </span>
          平台
        </h1>

        <!-- 副标题 -->
        <p class="text-lg md:text-xl text-white/90 mb-10 max-w-3xl mx-auto">
          专注于移动设备工具开发、软件开发和数字内容创作的创新团队，为您提供高质量的软件工具和技术解决方案
        </p>

        <!-- 行动召唤按钮 -->
        <div class="flex flex-col sm:flex-row gap-4 justify-center mb-12">
          <a
            href="#projects"
            class="btn-primary bg-white text-indigo-600 hover:bg-gray-100 border-0 px-8 py-4 text-lg font-semibold rounded-full shadow-xl hover:shadow-2xl transform hover:-translate-y-1 transition-all duration-300"
          >
            查看项目
          </a>
          <a
            href="#sites"
            class="bg-transparent text-white border-2 border-white hover:bg-white hover:text-indigo-600 px-8 py-4 text-lg font-semibold rounded-full shadow-xl hover:shadow-2xl transform hover:-translate-y-1 transition-all duration-300"
          >
            探索分站
          </a>
        </div>

        <!-- 滚动提示 -->
        <div class="absolute bottom-10 left-1/2 transform -translate-x-1/2 animate-bounce">
          <svg
            class="w-6 h-6 text-white"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
          </svg>
        </div>
      </div>
    </div>
  </section>

  <!-- Projects Widget ****************** -->

  <Projects
    id="projects"
    title="我们的项目作品"
    subtitle="探索领创工作室开发的各类软件工具和创意项目"
    tagline="项目展示"
    projects={projectsData}
  >
    <Fragment slot="bg">
      <div class="absolute inset-0 bg-blue-50 dark:bg-slate-800"></div>
    </Fragment>
  </Projects>

  <!-- Sites Widget ****************** -->

  <Sites
    id="sites"
    title="我们的分站平台"
    subtitle="探索领创工作室旗下的各个专业平台"
    tagline="分站导航"
    sites={sitesData}
  />

  <!-- About Widget ******************* -->

  <Content
    id="about"
    title="关于领创工作室"
    subtitle="我们是一个专注于数码科技领域的创新团队"
    tagline="关于我们"
    content="领创工作室成立于2020年，致力于为用户提供高质量的软件工具和技术解决方案。我们的团队由经验丰富的开发者、设计师和技术专家组成，专注于移动设备工具开发、软件开发和数字内容创作。"
    callToAction={{
      variant: 'primary',
      text: '联系我们',
      href: '/contact',
      icon: 'tabler:mail',
    }}
  />

  <!-- 模态框 -->
  <Modal />
</Layout>
