---
// 启用 SSR - 每次请求时动态渲染此页面
export const prerender = false;

import Layout from '~/layouts/PageLayout.astro';
import Hero from '~/components/widgets/Hero.astro';
import Content from '~/components/widgets/Content.astro';
import Features from '~/components/widgets/Features.astro';
import CallToAction from '~/components/widgets/CallToAction.astro';
import CustomStyles from '~/components/CustomStyles.astro';
import donateHero from '~/assets/images/heroes/donate-hero.jpg';

const metadata = {
  title: '支持我们 - 领创工作室',
  description: '支持领创工作室的发展，您的捐赠将帮助我们提供更好的服务和开发更多优质项目。多种捐赠方式，感谢您的支持！',
  keywords: '捐赠,支持,赞助,领创工作室,开源项目',
};

// 定义捐赠者数据类型
interface Donation {
  name: string;
  amount?: number;
  donationDate: string;
  message?: string;
}

// 获取捐赠者数据
let donationData: Donation[] = [];
let apiError = false;

try {
  // 直接从外部 API 获取捐赠数据
  const response = await fetch('https://api-g.lacs.cc/api/donors');

  if (response.ok) {
    const result = await response.json();
    if (result.success && result.data) {
      donationData = result.data;
      console.log('成功获取捐赠数据，共', donationData.length, '条记录');
    } else {
      console.warn('API 返回数据格式异常:', result);
      apiError = true;
    }
  } else {
    console.error('API 响应错误:', response.status, response.statusText);
    if (response.status === 401) {
      console.error('API 需要身份验证，请检查 API 密钥或认证配置');
    }
    apiError = true;
  }
} catch (error) {
  console.error('获取捐赠数据失败:', error);
  apiError = true;
}

// 如果 API 请求失败
if (apiError || donationData.length === 0) {
  console.log('api获取失败');
}

// 捐赠用途
const donationUsage = [
  {
    title: '服务器维护',
    description: '维护网站服务器、域名续费、CDN加速等基础设施费用。',
    icon: 'tabler:server',
    percentage: '40%',
  },
  {
    title: '项目开发',
    description: '投入新项目的研发，购买开发工具和软件许可证。',
    icon: 'tabler:code',
    percentage: '35%',
  },
  {
    title: '技术学习',
    description: '团队成员技术培训、购买学习资料和参加技术会议。',
    icon: 'tabler:book',
    percentage: '15%',
  },
  {
    title: '社区建设',
    description: '维护技术社区、举办活动、奖励贡献者等。',
    icon: 'tabler:users',
    percentage: '10%',
  },
];

// 支持者权益
const supporterBenefits = [
  {
    title: '专属标识',
    description: '在我们的项目和网站中展示支持者专属标识。',
    icon: 'tabler:badge',
  },
  {
    title: '优先支持',
    description: '享受技术支持和服务的优先处理权。',
    icon: 'tabler:star',
  },
];
---

<Layout metadata={metadata}>
  <CustomStyles />

  <!-- Hero Section -->
  <Hero
    tagline="支持我们"
    title="您的支持是我们前进的动力"
    subtitle="领创工作室致力于为用户提供优质的技术服务和开源项目。您的每一份支持都将帮助我们做得更好，为技术社区贡献更多价值。"
    image={{
      src: donateHero,
      alt: 'Donate Support',
    }}
  >
    <div slot="actions" class="flex flex-col sm:flex-row gap-5 justify-center">
      <a
        href="#donation-methods"
        data-magnetic
        class="bg-red-600 hover:bg-red-500 text-white px-10 py-4 text-lg font-bold rounded-full shadow-[0_0_20px_rgba(220,38,38,0.3)] transition-all duration-300 active:scale-95 flex items-center justify-center"
      >
        立即支持
      </a>
      <a
        href="#usage"
        data-magnetic
        class="bg-white/5 backdrop-blur-[var(--glass-blur)] text-white border border-[var(--glass-border)] hover:bg-white/10 hover:border-white/40 px-10 py-4 text-lg font-bold rounded-full shadow-[var(--shadow-boutique-xl)] transition-all duration-300 active:scale-95 flex items-center justify-center"
      >
        了解用途
      </a>
    </div>
  </Hero>

  <!-- 二维码展示 -->
  <section class="py-16 md:py-24 relative overflow-hidden" id="donation-methods">
    <!-- 背景饰点 -->
    <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-full pointer-events-none">
      <div class="absolute top-1/4 left-1/4 w-64 h-64 bg-red-500/10 rounded-full blur-[100px]"></div>
      <div class="absolute bottom-1/4 right-1/4 w-64 h-64 bg-blue-500/10 rounded-full blur-[100px]"></div>
    </div>

    <div class="container mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
      <div class="max-w-4xl mx-auto text-center">
        <h2 class="text-4xl md:text-5xl font-black mb-6 tracking-tight text-slate-900 dark:text-white">扫码支持</h2>
        <p class="text-xl text-slate-500 dark:text-slate-400 mb-16 max-w-2xl mx-auto">
          您的每一份心意，都是我们继续前行的燃料
        </p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
          <!-- 微信卡片 -->
          <div
            class="group relative bg-white/60 dark:bg-slate-900/40 backdrop-blur-xl border border-white/50 dark:border-slate-800/50 rounded-[2.5rem] p-10 shadow-[0_1px_2px_rgba(0,0,0,0.05),0_20px_40px_-10px_rgba(0,0,0,0.05)] hover:shadow-2xl hover:-translate-y-2 transition-all duration-500 overflow-hidden"
          >
            <div
              class="absolute inset-0 bg-gradient-to-br from-green-500/0 to-green-500/5 transition-opacity duration-500 opacity-0 group-hover:opacity-100"
            >
            </div>

            <div
              class="w-16 h-16 bg-green-500 rounded-3xl flex items-center justify-center mb-8 mx-auto shadow-lg shadow-green-500/30 overflow-hidden relative"
            >
              <i class="fab fa-weixin text-white text-3xl"></i>
            </div>

            <h3 class="text-2xl font-black mb-8 text-slate-800 dark:text-white">微信支付</h3>

            <div
              class="relative w-56 h-56 mx-auto mb-8 p-3 bg-white rounded-3xl shadow-inner border border-slate-100 group-hover:shadow-2xl transition-all duration-500"
            >
              <div
                class="absolute inset-0 bg-gradient-to-br from-green-500/5 to-transparent rounded-3xl pointer-events-none"
              >
              </div>
              <img
                src="/images/qrcodes/wechatpay.webp"
                alt="微信二维码"
                class="w-full h-full object-cover rounded-2xl grayscale group-hover:grayscale-0 transition-all duration-700"
              />
            </div>
            <p class="text-sm font-bold text-slate-400 uppercase tracking-widest">Scan with WeChat</p>
          </div>

          <!-- 支付宝卡片 -->
          <div
            class="group relative bg-white/60 dark:bg-slate-900/40 backdrop-blur-xl border border-white/50 dark:border-slate-800/50 rounded-[2.5rem] p-10 shadow-[0_1px_2px_rgba(0,0,0,0.05),0_20px_40px_-10px_rgba(0,0,0,0.05)] hover:shadow-2xl hover:-translate-y-2 transition-all duration-500 overflow-hidden"
          >
            <div
              class="absolute inset-0 bg-gradient-to-br from-blue-500/0 to-blue-500/5 transition-opacity duration-500 opacity-0 group-hover:opacity-100"
            >
            </div>

            <div
              class="w-16 h-16 bg-blue-500 rounded-3xl flex items-center justify-center mb-8 mx-auto shadow-lg shadow-blue-500/30 overflow-hidden relative"
            >
              <i class="fab fa-alipay text-white text-3xl"></i>
            </div>

            <h3 class="text-2xl font-black mb-8 text-slate-800 dark:text-white">支付宝</h3>

            <div
              class="relative w-56 h-56 mx-auto mb-8 p-3 bg-white rounded-3xl shadow-inner border border-slate-100 group-hover:shadow-2xl transition-all duration-500"
            >
              <div
                class="absolute inset-0 bg-gradient-to-br from-blue-500/5 to-transparent rounded-3xl pointer-events-none"
              >
              </div>
              <img
                src="/images/qrcodes/alipay.webp"
                alt="支付宝二维码"
                class="w-full h-full object-cover rounded-2xl grayscale group-hover:grayscale-0 transition-all duration-700"
              />
            </div>
            <p class="text-sm font-bold text-slate-400 uppercase tracking-widest">Scan with Alipay</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 支持者名单 -->
  <section class="py-16 md:py-20">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="max-w-4xl mx-auto text-center">
        <h2 class="text-3xl md:text-4xl font-bold mb-4">感谢支持者</h2>
        <p class="text-xl text-muted mb-12">感谢以下朋友对领创工作室的支持</p>

        <div class="bg-white dark:bg-gray-800 p-8 rounded-xl shadow-lg">
          {
            donationData.length > 0 ? (
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {donationData.map((supporter) => (
                  <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600">
                    <div class="flex items-center justify-between mb-2">
                      <p class="font-semibold text-lg">{supporter.name}</p>
                      <span class="text-xs bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-2 py-1 rounded-full">
                        支持者
                      </span>
                    </div>
                    <p class="text-sm text-muted">
                      <i class="fas fa-calendar mr-1" />
                      捐赠日期: {supporter.donationDate}
                    </p>
                  </div>
                ))}
              </div>
            ) : (
              <div class="text-center py-8">
                <p class="text-muted">暂无支持者数据</p>
              </div>
            )
          }

          <div class="mt-8 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
            <p class="text-sm text-muted">
              <i class="fas fa-info-circle mr-2"></i>
              支持者名单实时更新，如需匿名请在支付时备注说明
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 资金用途 -->
  <Features
    id="usage"
    title="资金使用透明化"
    subtitle="您的每一分支持都将用于以下方面"
    tagline="资金用途"
    items={donationUsage.map((usage) => ({
      title: usage.title,
      description: `${usage.description}<br><span class="text-primary font-bold">${usage.percentage}</span>`,
      icon: usage.icon,
    }))}
    columns={4}
  />

  <!-- 支持者权益 -->
  <Content title="支持者专属权益" subtitle="感谢您的支持，我们为支持者准备了专属权益" items={supporterBenefits}>
    <Fragment slot="content">
      <h3 class="text-2xl font-bold tracking-tight dark:text-white sm:text-3xl mb-2">成为我们的支持者</h3>
      支持金额不限，每一份心意都是对我们最大的鼓励。我们会定期公布资金使用情况，确保透明公开。
    </Fragment>

    <Fragment slot="bg">
      <div class="absolute inset-0 bg-blue-50 dark:bg-slate-800"></div>
    </Fragment>
  </Content>

  <!-- Call to Action -->
  <CallToAction
    actions={[
      {
        variant: 'primary',
        text: '立即支持',
        href: '#donation-methods',
        icon: 'tabler:heart',
      },
      {
        variant: 'secondary',
        text: '联系我们',
        href: '/contact',
        icon: 'tabler:message-circle',
      },
    ]}
  >
    <Fragment slot="title"> 感谢您的支持！ </Fragment>

    <Fragment slot="subtitle">
      您的每一份支持都将帮助我们做得更好，<br class="hidden md:inline" />
      为技术社区贡献更多价值。
    </Fragment>
  </CallToAction>
</Layout>

<style>
  .btn-primary {
    @apply bg-blue-600 text-white hover:bg-blue-700 transition-all duration-300;
  }
</style>
